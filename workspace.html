<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLine | Creation Plane</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;800&display=swap');

        :root {
            --bg-color: #0c0c0c;
            --accent: #222;
            --text: #ffffff;
            --text-dim: #666; 
            --ui-speed: 0.6s cubic-bezier(0.8, 0, 0.2, 1);
        }

        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%;
            background: #000; color: var(--text); 
            font-family: 'Inter', sans-serif; overflow: hidden; 
        }

        /* --- Loading Overlay --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease;
        }
        .loader-content { text-align: center; width: 280px; }
        .progress-track { width: 100%; height: 2px; background: #111; margin-top: 20px; }
        .progress-bar { width: 0%; height: 100%; background: #fff; transition: width 2.5s cubic-bezier(0.4, 0, 0.2, 1); }

        /* --- UI Bars --- */
        .ui-bar {
            position: fixed; left: 0; width: 100%;
            background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(20px);
            z-index: 1000; transition: transform var(--ui-speed), opacity var(--ui-speed);
            box-sizing: border-box; border: 1px solid var(--accent);
        }
        .top-nav { top: 0; height: 90px; padding: 0 3rem; display: flex; align-items: center; justify-content: space-between; border-width: 0 0 1px 0; }
        
        /* Footer - Elevated text and grid structure */
        .bottom-nav { 
            bottom: 0; height: 60px; padding: 0 3rem; 
            border-width: 1px 0 0 0; display: grid; 
            grid-template-columns: 1fr auto 1fr; align-items: center;
        }

        .is-panning .ui-bar { transform: translateY(-100%); opacity: 0; }
        .is-panning .bottom-nav { transform: translateY(100%); }

        /* Branding */
        .brand-block { display: flex; flex-direction: column; line-height: 1.2; }
        .brand-main { font-weight: 800; letter-spacing: 4px; font-size: 1.1rem; }
        .brand-sub { color: var(--text-dim); font-weight: 400; letter-spacing: 2px; font-size: 0.65rem; }
        .back-arrow { cursor: pointer; font-size: 1.1rem; margin-top: 10px; transition: 0.3s; width: fit-content; }
        .back-arrow:hover { color: #aaa; transform: translateX(-4px); }

        .universe-center-title { font-weight: 300; letter-spacing: 6px; font-size: 0.75rem; text-transform: uppercase; }

        /* Tool Dock */
        .tool-dock {
            position: fixed; left: 25px; top: 50%; transform: translateY(-50%);
            width: 45px; background: #0c0c0c; border: 1px solid var(--accent);
            border-radius: 25px; padding: 20px 0;
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            z-index: 1100; transition: opacity 0.4s;
        }
        .is-panning .tool-dock { opacity: 0; pointer-events: none; }

        /* --- Canvas & Grid --- */
        #viewport { width: 100vw; height: 100vh; cursor: grab; background: #000; }
        #world { 
            position: absolute; width: 10000px; height: 10000px; 
            background-image: 
                linear-gradient(to right, #111 1px, transparent 1px),
                linear-gradient(to bottom, #111 1px, transparent 1px);
            background-size: 100px 100px; /* Traditional Grid Lines */
            transform-origin: 0 0;
        }

        /* --- Nodes --- */
        .node {
            position: absolute; background: #111; border: 1px solid #333;
            border-radius: 4px; width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
        }
        .node-container { width: 450px; min-height: 300px; background: rgba(15,15,15,0.8); border: 1px solid #444; }
        
        .handle { height: 14px; background: #1a1a1a; cursor: grab; border-bottom: 1px solid #222; }
        .node-content { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        
        textarea, input { 
            background: #000; border: 1px solid #222; color: #fff; 
            font-family: inherit; font-size: 0.8rem; padding: 10px; outline: none;
        }

        .tool-item { width: 32px; height: 32px; border: 1px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #111; cursor: grab; font-size: 0.7rem; font-weight: 800; transition: 0.2s; }
        .tool-item:hover { background: #fff; color: #000; }

        #cursor-tooltip { position: fixed; pointer-events: none; background: #fff; color: #000; padding: 5px 10px; font-size: 0.6rem; font-weight: 800; border-radius: 2px; z-index: 5000; display: none; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="cursor-tooltip"></div>

    <div id="loader">
        <div class="loader-content">
            <div id="loader-msg" style="font-size: 0.6rem; letter-spacing: 4px; color: #666; text-transform: uppercase;">Initializing</div>
            <div class="progress-track"><div id="progress-bar" class="progress-bar"></div></div>
        </div>
    </div>

    <nav class="ui-bar top-nav">
        <div class="brand-block">
            <div class="brand-main">ALPHALINE <span style="font-weight:300; color:var(--text-dim);">| CREATION PLANE</span></div>
            <div class="back-arrow" onclick="triggerExitSequence()">←</div>
        </div>
        <div class="universe-center-title" id="active-name">UNIVERSE NAME</div>
        <div style="width: 150px;"></div>
    </nav>

    <footer class="ui-bar bottom-nav">
        <div id="footer-date" style="font-size: 0.65rem; color: #666; letter-spacing: 1px; margin-bottom: 5px;">JAN 21 2026</div>
        <div style="font-size: 0.6rem; color: #555; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px;">© 2026 ALPHALINE SYSTEMS</div>
        <div id="coord-display" style="font-size: 0.65rem; color: #666; text-align: right; letter-spacing: 1px; margin-bottom: 5px;">0, 0</div>
    </footer>

    <aside class="tool-dock">
        <div class="tool-item" draggable="true" ondragstart="sd(event,'container')" onmouseenter="tip('Create Container Frame')" onmouseleave="untip()">C</div>
        <div class="tool-item" draggable="true" ondragstart="sd(event,'text')" onmouseenter="tip('Create Text Node')" onmouseleave="untip()">T</div>
        <div class="tool-item" draggable="true" ondragstart="sd(event,'image')" onmouseenter="tip('Create Image Node')" onmouseleave="untip()">I</div>
    </aside>

    <div id="viewport">
        <div id="world"></div>
    </div>

    <script>
        const world = document.getElementById('world');
        const viewport = document.getElementById('viewport');
        const params = new URLSearchParams(window.location.search);
        const universeId = params.get('id');
        let universes = JSON.parse(localStorage.getItem('alphaline_universes') || "[]");
        let activeUniverse = universes.find(u => u.id == universeId);
        let worldPos = activeUniverse?.camera || { x: -4500, y: -4500 };

        // --- Drag/Drop Data ---
        function sd(e, type) { e.dataTransfer.setData('nodeType', type); }

        window.onload = () => {
            if (activeUniverse) {
                document.getElementById('active-name').innerText = activeUniverse.name;
                document.getElementById('loader-msg').innerText = `Transporting to the world of ${activeUniverse.name}`;
            }
            updateTimestamp();
            const bar = document.getElementById('progress-bar');
            setTimeout(() => { bar.style.width = '100%'; window.parent.postMessage('RETRACT_FRAME', '*'); }, 100);
            setTimeout(() => { 
                document.getElementById('loader').style.opacity = '0'; 
                setTimeout(() => { document.getElementById('loader').style.display = 'none'; initWorkspace(); }, 1000); 
            }, 3500);
        };

        function updateTimestamp() {
            const now = new Date();
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            document.getElementById('footer-date').innerText = `${months[now.getMonth()]} ${now.getDate()} ${now.getFullYear()}`;
        }

        function initWorkspace() {
            world.style.transform = `translate(${worldPos.x}px, ${worldPos.y}px)`;
            if (activeUniverse?.timeline) { activeUniverse.timeline.forEach(data => createNode(data)); }
        }

        // --- Panning Logic ---
        let isPanning = false, startX, startY;
        viewport.onmousedown = (e) => {
            if (e.target !== viewport && e.target !== world) return;
            isPanning = true; document.body.classList.add('is-panning');
            startX = e.clientX - worldPos.x; startY = e.clientY - worldPos.y;
        };
        window.onmousemove = (e) => {
            if (isPanning) {
                worldPos.x = e.clientX - startX; worldPos.y = e.clientY - startY;
                world.style.transform = `translate(${worldPos.x}px, ${worldPos.y}px)`;
                document.getElementById('coord-display').innerText = `${Math.round(-worldPos.x)}, ${Math.round(-worldPos.y)}`;
            }
            if(tooltip.style.display === 'block') { tooltip.style.left = e.clientX + 15 + 'px'; tooltip.style.top = e.clientY + 15 + 'px'; }
        };
        window.onmouseup = () => { isPanning = false; document.body.classList.remove('is-panning'); syncData(); };

        // --- Node Logic ---
        viewport.ondragover = e => e.preventDefault();
        viewport.ondrop = e => {
            const type = e.dataTransfer.getData('nodeType');
            const x = e.clientX - worldPos.x - 140;
            const y = e.clientY - worldPos.y - 50;
            createNode({ type, x, y });
            syncData();
        };

        function createNode(data) {
            const node = document.createElement('div');
            node.className = `node node-${data.type}`;
            node.style.left = data.x + 'px';
            node.style.top = data.y + 'px';
            node.dataset.id = data.boxId || 'box_' + Date.now();

            let content = `<div class="handle"></div><div class="node-content">`;
            content += `<input class="node-title" placeholder="Title" value="${data.title || ''}" oninput="syncData()">`;
            
            if(data.type === 'text') {
                content += `<textarea placeholder="Body Content" rows="5" oninput="syncData()">${data.body || ''}</textarea>`;
            } else if(data.type === 'image') {
                content += `<input placeholder="Image URL" value="${data.url || ''}" oninput="syncData()">`;
            } else if(data.type === 'container') {
                content += `<div style="height:150px; border:1px dashed #333; display:flex; align-items:center; justify-content:center; font-size:0.5rem; color:#444;">QUADRANT DROP ZONE</div>`;
            }
            
            content += `</div>`;
            node.innerHTML = content;
            world.appendChild(node);
            makeDraggable(node);
        }

        function makeDraggable(el) {
            const handle = el.querySelector('.handle');
            handle.onmousedown = (e) => {
                e.stopPropagation();
                let p3 = e.clientX, p4 = e.clientY;
                document.onmousemove = (e) => {
                    let p1 = p3 - e.clientX, p2 = p4 - e.clientY;
                    p3 = e.clientX; p4 = e.clientY;
                    el.style.top = (el.offsetTop - p2) + "px";
                    el.style.left = (el.offsetLeft - p1) + "px";
                };
                document.onmouseup = () => { document.onmousemove = null; syncData(); };
            };
        }

        // --- Tooltip ---
        const tooltip = document.getElementById('cursor-tooltip');
        function tip(t) { tooltip.innerText = t; tooltip.style.display = 'block'; }
        function untip() { tooltip.style.display = 'none'; }

        function syncData() {
            const blocks = document.querySelectorAll('.node');
            activeUniverse.timeline = Array.from(blocks).map(b => ({
                boxId: b.dataset.id,
                type: b.classList.contains('node-text') ? 'text' : b.classList.contains('node-image') ? 'image' : 'container',
                x: parseInt(b.style.left),
                y: parseInt(b.style.top),
                title: b.querySelector('.node-title').value,
                body: b.querySelector('textarea')?.value || "",
                url: b.querySelector('input:nth-child(2)')?.value || ""
            }));
            activeUniverse.camera = worldPos;
            const idx = universes.findIndex(u => u.id == universeId);
            if(idx !== -1) { universes[idx] = activeUniverse; localStorage.setItem('alphaline_universes', JSON.stringify(universes)); }
        }

        function triggerExitSequence() {
            syncData();
            const l = document.getElementById('loader');
            document.getElementById('loader-msg').innerText = "Returning to the Multiverse Hub";
            document.getElementById('progress-bar').style.width = '0%';
            l.style.display = 'flex'; l.style.opacity = '1';
            setTimeout(() => document.getElementById('progress-bar').style.width = '100%', 50);
            setTimeout(() => { window.parent.postMessage('RESTORE_FRAME', '*'); window.location.href = 'universes.html'; }, 2500);
        }
    </script>
</body>
</html>
